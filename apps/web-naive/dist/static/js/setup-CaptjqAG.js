var v=(c,w,x)=>new Promise((i,o)=>{var h=f=>{try{m(x.next(f))}catch(k){o(k)}},_=f=>{try{m(x.throw(f))}catch(k){o(k)}},m=f=>f.done?i(f.value):Promise.resolve(f.value).then(h,_);m((x=x.apply(c,w)).next())});import{ad as M,f as H,$ as s,ae as P,Z as T,Y as g,M as b,_ as S}from"./bootstrap-BO7TQOOQ.js";import{d as I,g as z,w as N,c as j,k as p,l as u,n as e,x as r,s as a,F as D,L as $,y as B,m as y,M as l}from"./index-index-CGxb6KVd.js";function L(c){return v(this,null,function*(){return console.log(c),M.post("/setup/db_test",c)})}function A(c){return v(this,null,function*(){return M.post("/setup/install",c)})}const R={style:{"min-height":"100vh","background-color":"#f9f9f9",padding:"20px","font-family":"Arial, sans-serif"}},q={style:{"max-width":"800px",margin:"0 auto"}},E={style:{"text-align":"center","margin-bottom":"20px"}},F={style:{"font-size":"28px",color:"#333","margin-bottom":"10px"}},Y={style:{color:"#666","font-size":"14px"}},Z={style:{"margin-bottom":"20px"}},G={style:{display:"flex",justifyContent:"center",alignItems:"center",gap:"0px",border:"1px solid rgba(34, 36, 38, 0.15)"}},J={style:{"background-color":"white","border-radius":"2px",padding:"10px","box-shadow":"0 2px 10px rgba(0,0,0,0.1)"}},K={key:0,style:{"margin-bottom":"20px"}},O={style:{color:"#555","line-height":"1.6"}},Q={style:{"margin-bottom":"15px"}},W={style:{"margin-bottom":"15px"}},X={style:{"background-color":"#fff3cd",border:"1px solid #ffeaa7","border-radius":"4px",padding:"15px","margin-bottom":"15px"}},ee={style:{"font-size":"14px",margin:"0"}},te={style:{"background-color":"#d1ecf1",border:"1px solid #bee5eb","border-radius":"4px",padding:"15px","margin-bottom":"20px"}},oe={style:{"font-size":"14px",margin:"0"}},de={style:{"text-align":"right"}},se={key:1,style:{"margin-bottom":"20px"}},re={style:{width:"100%",margin:"0 auto 20px"}},ae={style:{width:"100%","border-collapse":"collapse",border:"1px solid #ddd"}},ne={style:{width:"140px",padding:"12px",border:"1px solid #ddd",color:"#333","font-size":"14px","background-color":"#f8f9fa"}},le={style:{padding:"8px",border:"1px solid #ddd"}},ie={style:{display:"flex",gap:"20px","align-items":"center"}},pe={style:{display:"flex","align-items":"center",cursor:"pointer"}},ue={style:{display:"flex","align-items":"center",cursor:"pointer"}},xe={key:0},be={style:{padding:"12px",border:"1px solid #ddd",color:"#333","font-size":"14px","background-color":"#f8f9fa"}},ge={style:{padding:"8px",border:"1px solid #ddd"}},fe={style:{padding:"12px",border:"1px solid #ddd",color:"#333","font-size":"14px","background-color":"#f8f9fa"}},ye={style:{padding:"8px",border:"1px solid #ddd"}},ce={style:{padding:"12px",border:"1px solid #ddd",color:"#333","font-size":"14px","background-color":"#f8f9fa"}},me={style:{padding:"8px",border:"1px solid #ddd"}},ve={key:1},_e={style:{padding:"12px",border:"1px solid #ddd",color:"#333","font-size":"14px","background-color":"#f8f9fa"}},ke={style:{padding:"8px",border:"1px solid #ddd"}},we={key:2},he={style:{padding:"12px",border:"1px solid #ddd",color:"#333","font-size":"14px","background-color":"#f8f9fa"}},ze={style:{padding:"8px",border:"1px solid #ddd"}},Ce={style:{display:"flex","justify-content":"space-between"}},Pe={key:2,style:{"margin-bottom":"20px"}},Ue={style:{"max-width":"100%",margin:"0 auto 20px"}},Me={style:{width:"100%","border-collapse":"collapse",border:"1px solid #ddd","margin-bottom":"20px"}},Ve={style:{width:"140px",padding:"12px",border:"1px solid #ddd",color:"#333","font-size":"14px","background-color":"#f8f9fa"}},He={style:{padding:"8px",border:"1px solid #ddd"}},Te={style:{padding:"12px",border:"1px solid #ddd",color:"#333","font-size":"14px","background-color":"#f8f9fa"}},Se={style:{padding:"8px",border:"1px solid #ddd"}},Ie={style:{padding:"12px",border:"1px solid #ddd",color:"#333","font-size":"14px","background-color":"#f8f9fa"}},Ne={style:{padding:"8px",border:"1px solid #ddd"}},je={style:{padding:"12px",border:"1px solid #ddd",color:"#333","font-size":"14px","background-color":"#f8f9fa"}},De={style:{padding:"8px",border:"1px solid #ddd"}},$e={style:{padding:"12px",border:"1px solid #ddd",color:"#333","font-size":"14px","background-color":"#f8f9fa"}},Be={style:{padding:"8px",border:"1px solid #ddd"}},Le={style:{"margin-top":"15px"}},Ae={style:{display:"flex","justify-content":"space-between"}},Re={key:3,style:{"margin-bottom":"20px"}},qe={style:{"max-width":"100%",margin:"0 auto 20px"}},Ee={style:{width:"100%","border-collapse":"collapse",border:"1px solid #ddd"}},Fe={style:{width:"140px",padding:"12px",border:"1px solid #ddd",color:"#333","font-size":"14px","background-color":"#f8f9fa"}},Ye={style:{padding:"8px",border:"1px solid #ddd"}},Ze={style:{padding:"12px",border:"1px solid #ddd",color:"#333","font-size":"14px","background-color":"#f8f9fa"}},Ge={style:{padding:"8px",border:"1px solid #ddd"}},Je={style:{padding:"12px",border:"1px solid #ddd",color:"#333","font-size":"14px","background-color":"#f8f9fa"}},Ke={style:{padding:"8px",border:"1px solid #ddd"}},Oe={style:{display:"flex","justify-content":"space-between"}},Qe=["disabled"],We={key:0},Xe={key:1},et={key:4,style:{"text-align":"center","margin-bottom":"20px"}},tt={style:{width:"64px",height:"64px","background-color":"#d4edda","border-radius":"50%",display:"flex","align-items":"center","justify-content":"center",margin:"0 auto 20px"}},ot={style:{width:"32px",height:"32px",color:"#28a745"},fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},dt={style:{"margin-bottom":"20px"}},st={style:{"font-size":"24px","font-weight":"bold",color:"#333","margin-bottom":"10px"}},rt={style:{color:"#666","font-size":"14px"}},U=5,at=I({name:"Setup",__name:"setup",setup(c){const w=H(),x=z(!1),i=z(1),o=z({apiHost:"127.0.0.1",apiPort:10001,apiProtocol:"http",apiType:"new",nodeId:"",secret:"",databaseHost:"127.0.0.1",databasePort:3306,databaseName:"fastcdn",databaseUsername:"",databasePassword:"",adminUsername:"admin",adminPassword:"",confirmPassword:"",adminEmail:""});N(()=>o.value.apiType,n=>{n==="old"?(o.value.nodeId="",o.value.secret="",o.value.apiHost="",o.value.apiPort=""):n==="new"&&(o.value.apiPort===""&&(o.value.apiPort="10001"),o.value.apiHost===""&&(o.value.apiHost="127.0.0.1"))});const h=j(()=>[{key:"introduction",title:s("page.setup.steps.introduction")},{key:"apiConfig",title:s("page.setup.steps.apiConfig")},{key:"database",title:s("page.setup.steps.database")},{key:"admin",title:s("page.setup.steps.admin")},{key:"complete",title:s("page.setup.steps.complete")}]);function _(){return v(this,null,function*(){if(i.value<U){let n=!0;i.value===3&&((yield f())||(n=!1)),n&&i.value++}})}function m(){i.value>1&&i.value--}function f(){return v(this,null,function*(){if(x.value)return!1;if(o.value.databaseHost==="")return b.error("数据库主机不能为空!"),!1;if(o.value.databasePort==="")return b.error("数据库端口不能为空!"),!1;if(o.value.databaseName==="")return b.error("数据库名称不能为空!"),!1;if(o.value.databaseUsername==="")return b.error("数据库用户名不能为空!"),!1;if(o.value.databasePassword==="")return b.error("数据库密码不能为空!"),!1;x.value=!0;try{const n=yield L({hostname:o.value.databaseHost,port:o.value.databasePort,dbname:o.value.databaseName,username:o.value.databaseUsername,password:o.value.databasePassword});if(n.data.status===0)return b.success("数据库连接测试成功！"),!0;b.error(`${n.data.message}`)}catch(n){console.error("Database connection test failed:",n),b.error(`数据库连接测试失败：${n.message||"未知错误"}`)}finally{x.value=!1}return!1})}function k(){return v(this,null,function*(){if(!x.value){if(o.value.adminUsername===""){b.error("管理员用户名不能为空!");return}if(o.value.adminPassword===""){b.error("管理员密码不能为空!");return}x.value=!0;try{const n=yield A({api_host:o.value.apiHost,api_port:o.value.apiPort,api_protocol:o.value.apiProtocol,api_type:o.value.apiType,node_id:o.value.nodeId,secret:o.value.secret,hostname:o.value.databaseHost,port:o.value.databasePort,dbname:o.value.databaseName,username:o.value.databaseUsername,password:o.value.databasePassword,admin_username:o.value.adminUsername,admin_password:o.value.adminPassword});n.success?(b.success("系统安装成功！"),i.value=U):b.error(`系统安装失败：${n.data.message}`)}catch(n){console.error("Installation failed:",n),b.error(`系统安装失败：${n.message||"未知错误"}`)}finally{x.value=!1}}})}function V(){w.push("/auth/login")}return(n,t)=>(u(),p("div",R,[e("div",q,[e("div",E,[e("h2",F,r(a(s)("page.setup.title")),1),e("p",Y,r(a(s)("page.setup.description")),1)]),e("div",Z,[e("div",G,[(u(!0),p(D,null,$(h.value,(d,C)=>(u(),p("div",{key:d.key,style:{display:"flex","align-items":"center"}},[e("span",{style:B({marginLeft:"3px",fontSize:"15px",padding:"10px 15px 10px 15px",color:C+1<=i.value?"#007bff":"#666"})},r(C+1)+". "+r(d.title),5)]))),128))])]),e("div",J,[i.value===1?(u(),p("div",K,[e("div",O,[e("p",Q,r(a(s)("page.setup.step1.welcome")),1),e("p",W,r(a(s)("page.setup.step1.requirements")),1),e("div",X,[e("p",ee,r(a(s)("page.setup.step1.disclaimer")),1)]),e("div",te,[e("p",oe,r(a(s)("page.setup.step1.agreement")),1)])]),e("div",de,[e("button",{onClick:_,style:{"background-color":"#007bff",color:"white",padding:"10px 20px",border:"none","border-radius":"4px",cursor:"pointer","font-size":"14px"},onMouseover:t[0]||(t[0]=d=>d.target.style.backgroundColor="#0056b3"),onMouseout:t[1]||(t[1]=d=>d.target.style.backgroundColor="#007bff")},r(a(s)("page.setup.buttons.start")),33)])])):y("",!0),i.value===2?(u(),p("div",se,[e("div",re,[e("table",ae,[e("tbody",null,[e("tr",null,[e("td",ne,r(a(s)("page.setup.step2.api_type")),1),e("td",le,[e("div",ie,[e("label",pe,[l(e("input",{"onUpdate:modelValue":t[2]||(t[2]=d=>o.value.apiType=d),type:"radio",value:"new",style:{"margin-right":"8px"}},null,512),[[P,o.value.apiType]]),t[33]||(t[33]=e("span",{style:{"font-size":"14px",color:"#333"}},"自动启动新API节点",-1))]),e("label",ue,[l(e("input",{"onUpdate:modelValue":t[3]||(t[3]=d=>o.value.apiType=d),type:"radio",value:"old",style:{"margin-right":"8px"}},null,512),[[P,o.value.apiType]]),t[34]||(t[34]=e("span",{style:{"font-size":"14px",color:"#333"}},"使用已安装节点",-1))])])])]),o.value.apiType==="old"?(u(),p("tr",xe,[e("td",be,r(a(s)("page.setup.step2.protocol")),1),e("td",ge,[l(e("select",{"onUpdate:modelValue":t[4]||(t[4]=d=>o.value.apiProtocol=d),style:{width:"100%",padding:"8px",border:"1px solid #ddd","border-radius":"4px","font-size":"14px"}},t[35]||(t[35]=[e("option",{value:"http"},"HTTP",-1),e("option",{value:"https"},"HTTPS",-1)]),512),[[T,o.value.apiProtocol]])])])):y("",!0),e("tr",null,[e("td",fe,r(a(s)("page.setup.step2.host")),1),e("td",ye,[l(e("input",{"onUpdate:modelValue":t[5]||(t[5]=d=>o.value.apiHost=d),type:"text",style:{width:"100%",padding:"8px",border:"1px solid #ddd","border-radius":"4px","font-size":"14px"}},null,512),[[g,o.value.apiHost]])])]),e("tr",null,[e("td",ce,r(a(s)("page.setup.step2.port")),1),e("td",me,[l(e("input",{"onUpdate:modelValue":t[6]||(t[6]=d=>o.value.apiPort=d),type:"number",style:{width:"100%",padding:"8px",border:"1px solid #ddd","border-radius":"4px","font-size":"14px"}},null,512),[[g,o.value.apiPort]])])]),o.value.apiType==="old"?(u(),p("tr",ve,[e("td",_e,r(a(s)("page.setup.step2.node_id")),1),e("td",ke,[l(e("input",{"onUpdate:modelValue":t[7]||(t[7]=d=>o.value.nodeId=d),type:"text",style:{width:"100%",padding:"8px",border:"1px solid #ddd","border-radius":"4px","font-size":"14px"}},null,512),[[g,o.value.nodeId]])])])):y("",!0),o.value.apiType==="old"?(u(),p("tr",we,[e("td",he,r(a(s)("page.setup.step2.secret")),1),e("td",ze,[l(e("input",{"onUpdate:modelValue":t[8]||(t[8]=d=>o.value.secret=d),type:"text",style:{width:"100%",padding:"8px",border:"1px solid #ddd","border-radius":"4px","font-size":"14px"}},null,512),[[g,o.value.secret]])])])):y("",!0)])])]),e("div",Ce,[e("button",{onClick:m,style:{"background-color":"#6c757d",color:"white",padding:"10px 20px",border:"none","border-radius":"4px",cursor:"pointer","font-size":"14px"},onMouseover:t[9]||(t[9]=d=>d.target.style.backgroundColor="#545b62"),onMouseout:t[10]||(t[10]=d=>d.target.style.backgroundColor="#6c757d")},r(a(s)("page.setup.buttons.previous")),33),e("button",{onClick:_,style:{"background-color":"#007bff",color:"white",padding:"10px 20px",border:"none","border-radius":"4px",cursor:"pointer","font-size":"14px"},onMouseover:t[11]||(t[11]=d=>d.target.style.backgroundColor="#0056b3"),onMouseout:t[12]||(t[12]=d=>d.target.style.backgroundColor="#007bff")},r(a(s)("page.setup.buttons.next")),33)])])):y("",!0),i.value===3?(u(),p("div",Pe,[e("div",Ue,[e("table",Me,[e("tbody",null,[e("tr",null,[e("td",Ve,r(a(s)("page.setup.step3.host")),1),e("td",He,[l(e("input",{"onUpdate:modelValue":t[13]||(t[13]=d=>o.value.databaseHost=d),type:"text",style:{width:"100%",padding:"8px",border:"1px solid #ddd","border-radius":"4px","font-size":"14px"}},null,512),[[g,o.value.databaseHost]])])]),e("tr",null,[e("td",Te,r(a(s)("page.setup.step3.port")),1),e("td",Se,[l(e("input",{"onUpdate:modelValue":t[14]||(t[14]=d=>o.value.databasePort=d),type:"number",style:{width:"100%",padding:"8px",border:"1px solid #ddd","border-radius":"4px","font-size":"14px"}},null,512),[[g,o.value.databasePort]])])]),e("tr",null,[e("td",Ie,r(a(s)("page.setup.step3.database")),1),e("td",Ne,[l(e("input",{"onUpdate:modelValue":t[15]||(t[15]=d=>o.value.databaseName=d),type:"text",style:{width:"100%",padding:"8px",border:"1px solid #ddd","border-radius":"4px","font-size":"14px"}},null,512),[[g,o.value.databaseName]])])]),e("tr",null,[e("td",je,r(a(s)("page.setup.step3.username")),1),e("td",De,[l(e("input",{"onUpdate:modelValue":t[16]||(t[16]=d=>o.value.databaseUsername=d),type:"text",style:{width:"100%",padding:"8px",border:"1px solid #ddd","border-radius":"4px","font-size":"14px"}},null,512),[[g,o.value.databaseUsername]])])]),e("tr",null,[e("td",$e,r(a(s)("page.setup.step3.password")),1),e("td",Be,[l(e("input",{"onUpdate:modelValue":t[17]||(t[17]=d=>o.value.databasePassword=d),type:"password",style:{width:"100%",padding:"8px",border:"1px solid #ddd","border-radius":"4px","font-size":"14px"}},null,512),[[g,o.value.databasePassword]])])])])]),e("div",Le,[e("button",{onClick:f,style:{width:"100%","background-color":"#28a745",color:"white",padding:"10px",border:"none","border-radius":"4px",cursor:"pointer","font-size":"14px"},onMouseover:t[18]||(t[18]=d=>d.target.style.backgroundColor="#218838"),onMouseout:t[19]||(t[19]=d=>d.target.style.backgroundColor="#28a745")},r(a(s)("page.setup.step3.testConnection")),33)])]),e("div",Ae,[e("button",{onClick:m,style:{"background-color":"#6c757d",color:"white",padding:"10px 20px",border:"none","border-radius":"4px",cursor:"pointer","font-size":"14px"},onMouseover:t[20]||(t[20]=d=>d.target.style.backgroundColor="#545b62"),onMouseout:t[21]||(t[21]=d=>d.target.style.backgroundColor="#6c757d")},r(a(s)("page.setup.buttons.previous")),33),e("button",{onClick:_,style:{"background-color":"#007bff",color:"white",padding:"10px 20px",border:"none","border-radius":"4px",cursor:"pointer","font-size":"14px"},onMouseover:t[22]||(t[22]=d=>d.target.style.backgroundColor="#0056b3"),onMouseout:t[23]||(t[23]=d=>d.target.style.backgroundColor="#007bff")},r(a(s)("page.setup.buttons.next")),33)])])):y("",!0),i.value===4?(u(),p("div",Re,[e("div",qe,[e("table",Ee,[e("tbody",null,[e("tr",null,[e("td",Fe,r(a(s)("page.setup.step4.username")),1),e("td",Ye,[l(e("input",{"onUpdate:modelValue":t[24]||(t[24]=d=>o.value.adminUsername=d),type:"text",style:{width:"100%",padding:"8px",border:"1px solid #ddd","border-radius":"4px","font-size":"14px"}},null,512),[[g,o.value.adminUsername]])])]),e("tr",null,[e("td",Ze,r(a(s)("page.setup.step4.password")),1),e("td",Ge,[l(e("input",{"onUpdate:modelValue":t[25]||(t[25]=d=>o.value.adminPassword=d),type:"password",style:{width:"100%",padding:"8px",border:"1px solid #ddd","border-radius":"4px","font-size":"14px"}},null,512),[[g,o.value.adminPassword]])])]),e("tr",null,[e("td",Je,r(a(s)("page.setup.step4.confirmPassword")),1),e("td",Ke,[l(e("input",{"onUpdate:modelValue":t[26]||(t[26]=d=>o.value.confirmPassword=d),type:"password",style:{width:"100%",padding:"8px",border:"1px solid #ddd","border-radius":"4px","font-size":"14px"}},null,512),[[g,o.value.confirmPassword]])])])])])]),e("div",Oe,[e("button",{onClick:m,style:{"background-color":"#6c757d",color:"white",padding:"10px 20px",border:"none","border-radius":"4px",cursor:"pointer","font-size":"14px"},onMouseover:t[27]||(t[27]=d=>d.target.style.backgroundColor="#545b62"),onMouseout:t[28]||(t[28]=d=>d.target.style.backgroundColor="#6c757d")},r(a(s)("page.setup.buttons.previous")),33),e("button",{onClick:k,disabled:x.value,style:{"background-color":"#007bff",color:"white",padding:"10px 20px",border:"none","border-radius":"4px",cursor:"pointer","font-size":"14px"},onMouseover:t[29]||(t[29]=d=>d.target.style.backgroundColor="#0056b3"),onMouseout:t[30]||(t[30]=d=>d.target.style.backgroundColor="#007bff")},[x.value?(u(),p("span",We,"安装中...")):(u(),p("span",Xe,r(a(s)("page.setup.buttons.install")),1))],40,Qe)])])):y("",!0),i.value===5?(u(),p("div",et,[e("div",tt,[(u(),p("svg",ot,t[36]||(t[36]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},null,-1)])))]),e("div",dt,[e("h3",st,r(a(s)("page.setup.step5.success")),1),e("p",rt,r(a(s)("page.setup.step5.description")),1)]),e("button",{onClick:V,style:{"background-color":"#007bff",color:"white",padding:"12px 32px",border:"none","border-radius":"4px",cursor:"pointer","font-size":"16px"},onMouseover:t[31]||(t[31]=d=>d.target.style.backgroundColor="#0056b3"),onMouseout:t[32]||(t[32]=d=>d.target.style.backgroundColor="#007bff")},r(a(s)("page.setup.step5.loginButton")),33)])):y("",!0)])])]))}}),pt=S(at,[["__scopeId","data-v-212eae2d"]]);export{pt as default};
