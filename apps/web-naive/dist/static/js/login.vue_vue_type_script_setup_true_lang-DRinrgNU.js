var w=(h,u,n)=>new Promise((c,r)=>{var e=o=>{try{d(n.next(o))}catch(i){r(i)}},m=o=>{try{d(n.throw(o))}catch(i){r(i)}},d=o=>o.done?c(o.value):Promise.resolve(o.value).then(e,m);d((n=n.apply(h,u)).next())});import{u as $,f as C,$ as a,I as V,g as F,J as A,K as N,L as I,G as P,M as g}from"./bootstrap-BO7TQOOQ.js";import{T as K}from"./auth-title-BLSViL8P.js";import{d as v,r as q,c as E,g as j,j as D,k as b,l as f,v as S,A as _,m as y,B as k,C as B,x as p,s,n as U,D as L,q as x}from"./index-index-CGxb6KVd.js";const z=["onKeydown"],G={key:0,class:"mb-6 flex justify-between"},J={class:"flex-center"},Q=v({name:"AuthenticationLogin",__name:"login",props:{formSchema:{default:()=>[]},codeLoginPath:{default:"/auth/code-login"},forgetPasswordPath:{default:"/auth/forget-password"},loading:{type:Boolean,default:!1},qrCodeLoginPath:{default:"/auth/qrcode-login"},registerPath:{default:"/auth/register"},showCodeLogin:{type:Boolean,default:!0},showForgetPassword:{type:Boolean,default:!0},showQrcodeLogin:{type:Boolean,default:!0},showRegister:{type:Boolean,default:!0},showRememberMe:{type:Boolean,default:!0},showThirdPartyLogin:{type:Boolean,default:!0},subTitle:{default:""},title:{default:""},submitButtonText:{default:""}},emits:["submit"],setup(h,{expose:u,emit:n}){const c=h,r=n,[e,m]=$(q({commonConfig:{hideLabel:!0,hideRequiredMark:!0},schema:E(()=>c.formSchema),showDefaultActions:!1}));C();const d=`REMEMBER_ME_USERNAME_${location.hostname}`,o=localStorage.getItem(d)||"",i=j(!!o);function M(){return w(this,null,function*(){const{valid:t}=yield m.validate(),l=yield m.getValues();t&&(localStorage.setItem(d,i.value?l==null?void 0:l.username:""),r("submit",l))})}function R(){window.open("https://github.com/midoks/fastcdn","_blank")}return D(()=>{o&&m.setFieldValue("username",o)}),u({getFormApi:()=>m}),(t,l)=>(f(),b("div",{onKeydown:A(N(M,["prevent"]),["enter"])},[S(t.$slots,"title",{},()=>[_(K,null,{default:k(()=>[S(t.$slots,"title",{},()=>[B(p(t.title||`${s(a)("authentication.welcomeBack")}`),1)])]),_:3})]),_(s(e)),t.showRememberMe||t.showForgetPassword?(f(),b("div",G,[U("div",J,[t.showRememberMe?(f(),L(s(V),{key:0,checked:i.value,"onUpdate:checked":l[0]||(l[0]=T=>i.value=T),name:"rememberMe"},{default:k(()=>[B(p(s(a)("authentication.rememberMe")),1)]),_:1},8,["checked"])):y("",!0)]),t.showForgetPassword?(f(),b("span",{key:0,class:"vben-link text-sm font-normal",onClick:R},p(s(a)("authentication.forgetPassword")),1)):y("",!0)])):y("",!0),_(s(F),{class:x([{"cursor-wait":t.loading},"w-full"]),loading:t.loading,"aria-label":"login",onClick:M},{default:k(()=>[B(p(t.submitButtonText||s(a)("common.login")),1)]),_:1},8,["class","loading"])],40,z))}}),X=v({name:"Login",__name:"login",setup(h){const u=I(),n=E(()=>[{component:"VbenInput",componentProps:{placeholder:a("authentication.usernameTip")},fieldName:"username",label:a("authentication.username"),rules:P().min(1,{message:a("authentication.usernameTip")})},{component:"VbenInputPassword",componentProps:{placeholder:a("authentication.password")},fieldName:"password",label:a("authentication.password"),rules:P().min(1,{message:a("authentication.passwordTip")})}]);function c(r){return w(this,null,function*(){try{const e=yield u.authLogin(r);console.log("handleSubmit:",e)}catch(e){console.error("登录失败:",e),e&&typeof e=="object"?e.message?g.error(`登录失败: ${e.message}`):e.data&&e.data.message?g.error(`登录失败: ${e.data.message}`):g.error("登录失败，请稍后重试"):g.error("登录失败，请稍后重试")}})}return(r,e)=>(f(),L(s(Q),{"form-schema":n.value,loading:s(u).loginLoading,onSubmit:c},null,8,["form-schema","loading"]))}});export{X as _};
